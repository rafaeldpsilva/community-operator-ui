<div class="row">
  <div class="col-lg-3 col-md-6 col-sm-6">
    <div class="card card-demandresponse btn btn-sm btn-round" 
      [class.btn-outline-default]="idro_button != 2" 
      [class.btn-outline-success]="idro_button == 2" (click)="getIDRO()">
      <div class="row">
        <div class="col-5 col-md-4">
          <div class="icon-big text-center icon-warning">
            <i class="fa "
              [class.fa-cog]="idro_button == 1"
              [class.fa-spin]="idro_button == 1"
              [class.fa-fw]="idro_button == 1"
              [class.fa-area-chart]="idro_button != 1"
            ></i>
          </div>
        </div>
        <div class="col-7 col-md-8 align-self-center">
          <div class="numbers">
            <span >Identify DR Oportunities</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6 col-sm-6">
    <div class="card card-demandresponse btn btn-sm btn-round" [class.btn-outline-default]="flexibility_forecast_button != 2" 
    [class.btn-outline-success]="flexibility_forecast_button == 2" 
      (click)="getIoTFlexibility()">
      <div class="row">
        <div class="col-5 col-md-4">
          <div class="icon-big text-center icon-warning">
            <i class="fa "
              [class.fa-cog]="flexibility_forecast_button == 1"
              [class.fa-spin]="flexibility_forecast_button == 1"
              [class.fa-fw]="flexibility_forecast_button == 1"
              [class.fa-bar-chart]="flexibility_forecast_button != 1"
            ></i>
          </div>
        </div>
        <div class="col-7 col-md-8 align-self-center">
          <div class="numbers">
            <span >Flexibility Forecast
              </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6 col-sm-6">
    <div class="card card-demandresponse btn btn-sm btn-round"
      [class.btn-outline-default]="ranking_button != 2" 
      [class.btn-outline-success]="ranking_button == 2" 
      (click)="runRanking()">
      <div class="row">
        <div class="col-5 col-md-4">
          <div class="icon-big text-center icon-warning">
            <i class="fa "
              [class.fa-cog]="ranking_button == 1"
              [class.fa-spin]="ranking_button == 1"
              [class.fa-fw]="ranking_button == 1"
              [class.fa-list-ol]="ranking_button != 1"
            ></i>
          </div>
        </div>
        <div class="col-7 col-md-8 align-self-center">
          <div class="numbers">
            <span>Ranking
              </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6 col-sm-6">
    <div class="card card-demandresponse btn btn-sm btn-round"
      [class.btn-outline-default]="invite_participants_button != 2" 
      [class.btn-outline-success]="invite_participants_button == 2"
      (click)="inviteParticipants()">
      <div class="row">
        <div class="col-5 col-md-4">
          <div class="icon-big text-center icon-warning">
            <i class="fa "
              [class.fa-cog]="invite_participants_button == 1"
              [class.fa-spin]="invite_participants_button == 1"
              [class.fa-fw]="invite_participants_button == 1"
              [class.fa-envelope]="invite_participants_button != 1"
            ></i>
          </div>
        </div>
        <div class="col-7 col-md-8 align-self-center">
          <div class="numbers">
            <span >Invite Participants
              </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title">Events</h4>
        <p *ngIf="upcomingEvents.length == 0" class="card-category">No Upcoming Events</p>
      </div>
      <div class="card-body">
        <div *ngIf="upcomingEvents.length != 0" class="table-responsive">
          <table id="rankingTable" class="table table-hover">
            <thead class=" text-primary">
              <th>
                Event Time
              </th>
              <th>
                Accepted
              </th>
              <th>
                Declined
              </th>
            </thead>
            <tbody >
              <ng-container *ngFor="let item of upcomingEvents; let i = index">
                <tr (click)="createEventMonitoringChart(item.time)">
                  <td>{{ item.time }}</td>
                  <td [ngStyle]="{ color: 'green'}">{{ item.okParticipants }}</td>
                  <td [ngStyle]="{ color: 'red' }">{{ item.notOkParticipants }}</td>
                </tr>
              </ng-container>
            </tbody>
            <tbody >
              <ng-container *ngFor="let item of currentEvents; let i = index">
                <tr (click)="createEventMonitoringChart(item.time)">
                  <td>{{ item.time }}</td>
                  <td [ngStyle]="{ color: 'green'}">{{ item.okParticipants }}</td>
                  <td [ngStyle]="{ color: 'red' }">{{ item.notOkParticipants }}</td>
                </tr>
              </ng-container>
            </tbody>
            <tbody >
              <ng-container *ngFor="let item of historicEvents; let i = index">
                <tr (click)="createEventMonitoringChart(item.time)">
                  <td>{{ item.time }}</td>
                  <td [ngStyle]="{ color: 'green'}">{{ item.okParticipants }}</td>
                  <td [ngStyle]="{ color: 'red' }">{{ item.notOkParticipants }}</td>
                </tr>
              </ng-container>
            </tbody>
          </table>          
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="idro_button != 2" class="col-md-4">
    <div class="card ">
      <div class="card-header ">
        <h5 class="card-title">Next Event</h5>
        <p class="card-category">T- {{ event_time_left }}</p>
      </div>
      <div class="card-body">
        <p>At: {{ next_event }}</p>
      </div>
    </div>
  </div>
  <div *ngIf="idro_button == 2" class="col-md-4">
    <div class="card ">
      <div class="card-header ">
        <h5 class="card-title">Demand Response Event</h5>
        <p class="card-category">Choose hour to create demand response event</p>
      </div>
      <div class="card-body">
        <select [(ngModel)]="selectedHour" aria-label=".form-select-lg example" style="background-color: #cfcfcf00; border: 1px solid #66615B !important; box-shadow: 0 6px 10px -4px #00000026; border-radius: 12px; margin-top: 10px; font-size: x-large;">
          <option *ngFor="let option of eventHours" [value]="option">{{ option }}</option>
        </select>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-8">
    <div class="card ">
      <div class="card-header ">
        <h5 class="card-title">Event Monitoring</h5>
        <p class="card-category">Current Event</p>
      </div>
      <div class="card-body ">
        <canvas id=chartEventMonitoring width="400" height="100"></canvas>
      </div>
      <div class="card-footer ">
        <div class="legend">
          <i class="fa fa-circle text-primary"></i> Aggregated Balance
        </div>
        <hr>
        <div class="stats">
          <i class="fa fa-history"></i> Updated 3 minutes ago
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card ">
      <div class="card-header ">
        <h5 class="card-title">Average Metric Score</h5>
        <p class="card-category">Last Demand Response Event</p>
      </div>
      <div class="card-body ">
        <canvas id="chartMetrics"></canvas>
      </div>
      <div class="card-footer ">
        <div class="legend">
          <i class="fa fa-circle text-primary"></i> Metric 1
          <i class="fa fa-circle text-warning"></i> Metric 2
          <i class="fa fa-circle text-danger"></i> Metric 3
          <i class="fa fa-circle text-gray"></i> Metric 4
        </div>
        <hr>
        <div class="stats">
          <i class="fa fa-calendar"></i> Last Event: {{last_dro_char_datetime}}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="card card-chart">
      <div class="card-header">      
          <h5 class="card-title">Demand Response Opportunities</h5>
          <p class="card-category">Forecast For Tommorow</p>
      </div>
      <div class="card-body">
        <canvas id="speedChart" width="400" height="100"></canvas>
      </div>
      <div class="card-footer">
        <div class="chart-legend">
          <div class="col-md-3 col-3">
            <i class="fa fa-circle text-primary"></i> Consumption
            <i class="fa fa-circle text-success"></i> Generation
            <i class="fa fa-circle text-danger"></i> Flexibility
          </div>
          <div class="col-md-3 col-3">
            <i class="fa fa-circle-thin text-purple"></i> DR Opportunity
            <i class="fa fa-circle-thin text-success"></i> Generation Surplus
          </div>
        </div>
        <hr/>
        <div class="card-stats">
          <i class="fa fa-check"></i> Last Event: {{last_dro_char_datetime}}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title"> Ranking</h4>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table id="rankingTable" class="table table-hover">
            <thead class=" text-primary">
              <th>
                Name
              </th>
              <th>
                Flexibility
              </th>
              <th>
                Metric 1 - Historic of Average vs Participation (%)
              </th>
              <th>
                Metric 2 - Average Energy Reduction vs Total Participation
              </th>
              <th>
                Metric 3 - Flexibility (Reduction) vs Participation (%)
              </th>
              <th>
                Metric 4 - Shifting Cost
              </th>
              <th>
                Total Score
              </th>
              <th>
                Fair Score
              </th>
            </thead>
            <tbody >
              <ng-container *ngFor="let item of rankingTable; let i = index">
                <tr *ngIf="isRankingTableExtended || i < 5" (click)="onRowClick(item)"
                  [ngStyle]="{ color: i < mainParticipants ? 'green' : 'black' }">
                  <td>{{ item.name }}</td>
                  <td>{{ item.flexibility }}</td>
                  <td>{{ item.metric1 }}</td>
                  <td>{{ item.metric2 }}</td>
                  <td>{{ item.metric3 }}</td>
                  <td>{{ item.metric4 }}</td>
                  <td>{{ item.totalscore }}</td>
                  <td>{{ item.fairscore }}</td>
                </tr>
              </ng-container>
            </tbody>
          </table>
          <div class="text-center">
            <a class="" (click)="extendTable()">
              <i *ngIf="!isRankingTableExtended" class="fa fa-angle-down"></i>
              <i *ngIf="isRankingTableExtended" class="fa fa-angle-up"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>